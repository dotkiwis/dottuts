<!DOCTYPE html>
<html lang="en">

<head>
    <title>Bootstrap Example</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
</head>
<style>
    .numberCircle {
        border-radius: 50%;
        behavior: url(PIE.htc);
        /* remove if you don't care about IE8 */
        width: 55px;
        height: 55px;
        padding: 8px;
        background: #f2dede;
        color: #fff;
        text-align: center;
        font: 32px Arial, sans-serif;
        display: inline-block
    }

    .numberCircle:hover {
        border: 2px solid #666;
        background: #000000;
    }

    .btn {
        float: left;
        margin: 0 100px;
    }

    .button7 {
        background-color: #00f040;
        color: white;
        padding: 15px 32px;
        font-size: 8px;
        margin: 2px 2px;
        width: 150px;
        border: 2px solid #00000f;
        border-radius: 8px;
    }
</style>

<body>

    <div class="container">
        <h2>Table</h2>
        <button onclick="myFunction()">Calender</button>
        <select id="monthh">
            <option value="0">Jan</option>
            <option value="1">Feb</option>
            <option value="2">Mar</option>
            <option value="3">Apr</option>
            <option value="4">My</option>
            <option value="5">June</option>
            <option value="6">July</option>
            <option value="7">August</option>
            <option value="8">Sep</option>
            <option value="9">O</option>
            <option value="10">N</option>
            <option value="11">D</option>

        </select>
        <table id="cable" class="table-bordered table-hover">
            <tr>
                <th>Saturday</th>
                <th>Sunday</th>
                <th>Monday</th>
                <th>Tuesday</th>
                <th>wednesday</th>
                <th>Thursday</th>
                <th>Firday</th>
            </tr>
        </table>

        <div id="myDIV">
            <h1 id="dno"></h1>
            <ul class="list-group">
                <li class="list-group-item ">10AM - 11AM<button id="s1" onclick="popup(this,'s1')" data-toggle="modal"
                        data-target="#exampleModal" type="button" class="button7 ">Book Appointment</button></li>
                <li class="list-group-item ">11AM - 12PM <button id="s2" onclick="popup(this,'s2')" data-toggle="modal"
                        data-target="#exampleModal" type="button" class="button7 ">Book Appointment</button></li>
                <!--<li class="list-group-item ">Lunch </li>-->
                <li class="list-group-item ">2PM - 3PM <button id="s3" onclick="popup(this,'s3')" data-toggle="modal"
                        data-target="#exampleModal" type="button" class="button7">Book Appointment</button></li>
                <li class="list-group-item ">3PM - 4PM <button id="s4" onclick="popup(this,'s4')" data-toggle="modal"
                        data-target="#exampleModal" type="button" class="button7 ">Book Appointment</button></li>
            </ul>
        </div>
        <div>
            <p id="demo"></p>
        </div>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">

                <div class="modal-header">
                    <h5 class="modal-title" id="titl">Modal title</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <div class="modal-body">
                    <form>
                        <div class="form-group">
                            <label for="exampleInputEmail1">Name </label>
                            <input type="text" class="form-control" id="name" placeholder="Name">
                        </div>
                        <div class="form-group">
                            <label for="exampleInputPassword1">Mobile</label>
                            <input type="text" class="form-control" id="mob" placeholder="Mobile">
                        </div>
                    </form>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" onclick="apply()" data-dismiss="modal" class="btn btn-primary">Submit</button>
                </div>

            </div>
        </div>
    </div>
    <script language="javascript">
        var year = [{
            month: 01
        }, {
            month: 02,
            days: [1, 2]
        }, {
            month: 03
        }, {
            month: 04
        }, {
            month: 05
        }, {
            month: 06,
            monthName: "June",
            days: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25,
                26, 27, 28, 29, 30
            ]
        }, {
            month: 07,
            monthName: "July",
            days: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25,
                26, 27, 28, 29, 30, 31
            ]
        }, {
            month: 08,
            monthName: "August",
            days: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25,
                26, 27, 28, 29, 30
            ]
        }, {
            month: 09
        }, {
            month: 10
        }, {
            month: 11
        }, {
            month: 12
        }]

        var getDaysInMonth = function (month, year) {
            return new Date(year, month, 0).getDate();
        };

        function range(start, end) {
            return (new Array(end - start + 1)).fill(undefined).map((_, i) => i + start);
        }

        let currentMonth;

        function myFunction() {
            currentMonth = document.getElementById("monthh").value;
            console.log(currentMonth)

            var table = document.getElementById("cable");
            table.innerHTML = "";
            let b = 0;

            var a = year[currentMonth].days;
            for (i = 0; i < a.length / 7; i++) {
                var row = table.insertRow(i);
                if (i < (a.length / 7) - 1) {
                    for (j = 0; j < 7; j++) {
                        console.log("i", i, "j", j, "i+j", i + j, "b", b)
                        var cell1 = row.insertCell(j);
                        var x = document.createElement("span");
                        x.className = 'numberCircle';
                        x.innerHTML = a[i + j + b];
                        cell1.append(x);
                        cell1.onclick = function () {
                            getval(this);
                        };
                    }
                    b += 6;
                } else {
                    for (j = 0; j < a.length % 7; j++) {
                        console.log("i", i, "j", j, "i+j", i + j, "b", b)
                        var cell1 = row.insertCell(j);
                        var x = document.createElement("span");
                        x.className = 'numberCircle';
                        x.innerHTML = a[i + j + b];
                        cell1.append(x);
                        cell1.onclick = function () {
                            getval(this);
                        };

                    }
                }
            }
        }
        var values = [];
        var date;

        var bookings = [];

        function getval(cel) {
            console.log(cel);
            date = cel.getElementsByTagName('span')[0].innerHTML;
            let fullDate = "2019-" + year[currentMonth].month + "-" + date;

            getDaySlots({
                date: fullDate
            });

            console.log(date);

            values.push(cel.innerHTML);
            var x = document.getElementById("dno");

            console.log(x)

            x.innerHTML = cel.innerHTML;
        }
        var gslot;
        var gcurrent;

        function popup(current, slot) {
            var cbl = document.getElementById("titl");
            gcurrent = current;
            cbl.innerHTML = date + " " + slot;
            gslot = slot;
            console.log(date, slot);
        }

        function apply() {

            var name = document.getElementById("name").value;
            var mob = document.getElementById("mob").value;
            console.log(date, gslot, name, mob);
            let fullDate = "2019-" + year[currentMonth].month + "-" + date;
            console.log(fullDate)

            addAppoint({
                date: fullDate,
                slot: gslot,
                name: name,
                mobile: mob,
                email: "a@b.com",
                message: "hi"
            });

            document.getElementById("name").value = "";
            document.getElementById("mob").value = "";
            gcurrent.disabled = true;

            if (gslot === 's1') {
                bookings[0] = true;
            } else if (gslot === 's2') {
                bookings[1] = true;
            } else if (gslot === 's3') {
                bookings[2] = true;
            } else if (gslot === 's4') {
                bookings[3] = true;
            }

        }

        function addAppoint(oswa) {
            console.log(oswa)
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    document.getElementById("demo").innerHTML = this.response;
                }
            };
            xhttp.open("POST", "http://127.0.0.1/db/add_new_appointment.php", true);
            xhttp.setRequestHeader("Content-Type", "application/json");

            xhttp.send(JSON.stringify(oswa));
        }

        function getDaySlots(data) {
            console.log(data)
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    document.getElementById("demo").innerHTML = this.response;
                    bookings = JSON.parse(this.response);
                    console.log(bookings);
                    document.getElementById('s1').disabled = bookings[0];
                    document.getElementById('s2').disabled = bookings[1];
                    document.getElementById('s3').disabled = bookings[2];
                    document.getElementById('s4').disabled = bookings[3];
                }
            };
            xhttp.open("POST", "http://127.0.0.1/db/get_available_slots.php", true);
            xhttp.setRequestHeader("Content-Type", "application/json");

            xhttp.send(JSON.stringify(data));
        }


        // A $( document ).ready() block.
        $(document).ready(function () {
            var d = new Date();
            var n = d.getMonth();

            document.getElementById("monthh").value = n;
            myFunction();
        });
    </script>

</body>

</html>